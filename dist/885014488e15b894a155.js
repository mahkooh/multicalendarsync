/*! For license information please see 885014488e15b894a155.js.LICENSE.txt */
function _slicedToArray(e,n){return _arrayWithHoles(e)||_iterableToArrayLimit(e,n)||_unsupportedIterableToArray(e,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,a,c,i=[],s=!0,l=!1;try{if(a=(r=r.call(e)).next,0===n){if(Object(r)!==r)return;s=!1}else for(;!(s=(t=a.call(r)).done)&&(i.push(t.value),i.length!==n);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw a}}}}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}function ownKeys(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(r),!0).forEach(function(n){_defineProperty(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _defineProperty(e,n,r){return(n=_toPropertyKey(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function _regenerator(){var e,n,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,t,o,a){var s=t&&t.prototype instanceof i?t:i,l=Object.create(s.prototype);return _regeneratorDefine2(l,"_invoke",function(r,t,o){var a,i,s,l=0,u=o||[],f=!1,d={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(n,r){return a=n,i=0,s=e,d.n=r,c}};function y(r,t){for(i=r,s=t,n=0;!f&&l&&!o&&n<u.length;n++){var o,a=u[n],y=d.p,h=a[2];r>3?(o=h===t)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,d.v=t,d.n=a[1]):y<h&&(o=r<3||a[0]>t||t>h)&&(a[4]=r,a[5]=t,d.n=h,i=0))}if(o||r>1)return c;throw f=!0,t}return function(o,u,h){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&y(u,h),i=u,s=h;(n=i<2?e:s)||!f;){a||(i?i<3?(i>1&&(d.n=-1),y(i,s)):d.n=s:d.v=s);try{if(l=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((n=(f=d.n<0)?s:r.call(t,d))!==c)break}catch(n){a=e,i=1,s=n}finally{l=1}}return{value:n,done:f}}}(r,o,a),!0),l}var c={};function i(){}function s(){}function l(){}n=Object.getPrototypeOf;var u=[][t]?n(n([][t]())):(_regeneratorDefine2(n={},t,function(){return this}),n),f=l.prototype=i.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=l,_regeneratorDefine2(f,"constructor",l),_regeneratorDefine2(l,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(l,o,"GeneratorFunction"),_regeneratorDefine2(f),_regeneratorDefine2(f,o,"Generator"),_regeneratorDefine2(f,t,function(){return this}),_regeneratorDefine2(f,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:d}})()}function _regeneratorDefine2(e,n,r,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,n,r,t){function a(n,r){_regeneratorDefine2(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!t,configurable:!t,writable:!t}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,n,r,t)}function asyncGeneratorStep(e,n,r,t,o,a,c){try{var i=e[a](c),s=i.value}catch(e){return void r(e)}i.done?n(s):Promise.resolve(s).then(t,o)}function _asyncToGenerator(e){return function(){var n=this,r=arguments;return new Promise(function(t,o){var a=e.apply(n,r);function c(e){asyncGeneratorStep(a,t,o,c,i,"next",e)}function i(e){asyncGeneratorStep(a,t,o,c,i,"throw",e)}c(void 0)})}}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,_toPropertyKey(t.key),t)}}function _createClass(e,n,r){return n&&_defineProperties(e.prototype,n),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var n=_toPrimitive(e,"string");return"symbol"==_typeof(n)?n:n+""}function _toPrimitive(e,n){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,n||"default");if("object"!=_typeof(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}export var CalendarSyncManager=function(){return _createClass(function e(){_classCallCheck(this,e),this.syncEnabled=!1,this.calendars=new Map,this.syncInterval=null,this.lastSync=null,this.syncInProgress=!1,this.config={syncIntervalMinutes:15,busyBlockSubject:"[Auto-Sync] Busy",busyBlockCategory:"Auto-Sync",lookAheadDays:0,lookBehindDays:0}},[{key:"initialize",value:(b=_asyncToGenerator(_regenerator().m(function e(){var n,r;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,console.log("Initializing Calendar Sync Manager..."),window.Office){e.n=1;break}throw new Error("Office.js is not loaded");case 1:return Office.context&&Office.context.mailbox||console.warn("Limited Office context detected, some features may not work"),console.log("Office context available:",!!Office.context),console.log("Mailbox available:",!(null===(n=Office.context)||void 0===n||!n.mailbox)),e.n=2,this.requestPermissions();case 2:return this.loadConfiguration(),e.n=3,this.discoverCalendars();case 3:this.syncEnabled&&this.startAutoSync(),console.log("Calendar Sync Manager initialized successfully"),e.n=5;break;case 4:throw e.p=4,r=e.v,console.error("Failed to initialize Calendar Sync Manager:",r),r;case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return b.apply(this,arguments)})},{key:"requestPermissions",value:(g=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,n){try{if(!Office.context||!Office.context.mailbox)return console.warn("Limited Office context, proceeding with basic initialization"),void e();var r=Office.context.mailbox.diagnostics,t=null==r?void 0:r.hostName;console.log("Host diagnostics:",{hostName:t,hostVersion:null==r?void 0:r.hostVersion,platform:null==r?void 0:r.platform}),"Outlook"!==t&&"OutlookWebApp"!==t&&"OutlookIOS"!==t&&"OutlookAndroid"!==t&&t?(console.warn("Unknown host detected, proceeding anyway:",t),e()):(console.log("Host validation passed for:",t||"unknown host"),e())}catch(n){console.error("Error in requestPermissions:",n),e()}}))},e)})),function(){return g.apply(this,arguments)})},{key:"loadConfiguration",value:function(){try{var e=localStorage.getItem("calendarSync_config");if(e){var n=JSON.parse(e);this.config=_objectSpread(_objectSpread({},this.config),n)}var r=localStorage.getItem("calendarSync_enabled");this.syncEnabled="true"===r}catch(e){console.warn("Failed to load configuration:",e)}}},{key:"saveConfiguration",value:function(){try{localStorage.setItem("calendarSync_config",JSON.stringify(this.config)),localStorage.setItem("calendarSync_enabled",this.syncEnabled.toString())}catch(e){console.warn("Failed to save configuration:",e)}}},{key:"discoverCalendars",value:(v=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,o=this;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Discovering real Microsoft accounts and calendars..."),e.n=1,this.getGraphCalendars();case 1:if(!((n=e.v)&&n.length>0)){e.n=2;break}this.calendars.clear(),n.forEach(function(e){o.calendars.set(e.id,e)}),console.log("✅ Discovered ".concat(this.calendars.size," real calendars from Graph API:")),Array.from(this.calendars.values()).forEach(function(e){console.log("  📅 ".concat(e.name," (").concat(e.userEmail,") - Default: ").concat(e.isDefaultCalendar))}),e.n=3;break;case 2:throw new Error("No calendars returned from Graph API");case 3:case 6:e.n=8;break;case 4:return e.p=4,r=e.v,console.warn("⚠️ Graph API discovery failed, checking why:",r),e.p=5,e.n=6,this.tryAlternativeDiscovery();case 7:return e.p=7,t=e.v,console.warn("⚠️ Alternative discovery also failed:",t),console.log("📝 Using enhanced mock data with email simulation..."),e.n=8,this.discoverEnhancedMockCalendars();case 8:return e.a(2)}},e,this,[[5,7],[0,4]])})),function(){return v.apply(this,arguments)})},{key:"tryAlternativeDiscovery",value:(m=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,o,a,c,i,s,l=this;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getGraphAccessToken();case 1:return n=e.v,console.log("🔍 Testing Graph API access with user profile..."),e.n=2,fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 2:if((r=e.v).ok){e.n=3;break}throw new Error("Profile API error: ".concat(r.status," ").concat(r.statusText));case 3:return e.n=4,r.json();case 4:return t=e.v,console.log("✅ Authenticated as: ".concat(t.displayName," (").concat(t.mail||t.userPrincipalName,")")),e.n=5,fetch("https://graph.microsoft.com/v1.0/me/calendars",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 5:if((o=e.v).ok){e.n=7;break}return e.n=6,o.text();case 6:throw a=e.v,new Error("Calendars API error: ".concat(o.status," ").concat(o.statusText," - ").concat(a));case 7:return e.n=8,o.json();case 8:c=e.v,console.log("📅 Raw calendar data from Graph:",c),i=t.mail||t.userPrincipalName,s=c.value.map(function(e){var n;return{id:e.id,name:e.name,userEmail:(null===(n=e.owner)||void 0===n||null===(n=n.emailAddress)||void 0===n?void 0:n.address)||i,type:"Microsoft Graph",syncEnabled:!0,canEdit:e.canEdit||!1,isDefaultCalendar:e.isDefaultCalendar||!1}}),this.calendars.clear(),s.forEach(function(e){l.calendars.set(e.id,e)}),console.log("✅ Successfully discovered ".concat(s.length," calendars with emails"));case 9:return e.a(2)}},e,this)})),function(){return m.apply(this,arguments)})},{key:"discoverEnhancedMockCalendars",value:(p=_asyncToGenerator(_regenerator().m(function e(){var n,r=this;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:n=[{id:"calendar-1",name:"Primary Work Calendar",userEmail:"dan.hookham@company1.com",type:"Exchange Online",syncEnabled:!0,isDefaultCalendar:!0},{id:"calendar-2",name:"Secondary Work Calendar",userEmail:"dan.hookham@company2.com",type:"Office 365",syncEnabled:!0,isDefaultCalendar:!1},{id:"calendar-3",name:"Personal Calendar",userEmail:"dan.hookham@outlook.com",type:"Outlook.com",syncEnabled:!0,isDefaultCalendar:!1},{id:"calendar-4",name:"Project Calendar",userEmail:"dan.hookham@company3.com",type:"Exchange",syncEnabled:!0,isDefaultCalendar:!1},{id:"calendar-5",name:"Client Calendar",userEmail:"dan.hookham@company4.com",type:"Office 365",syncEnabled:!0,isDefaultCalendar:!1}],this.calendars.clear(),n.forEach(function(e){r.calendars.set(e.id,e)}),console.log("📝 Using enhanced mock calendars with email addresses:"),n.forEach(function(e){console.log("  📅 ".concat(e.name," (").concat(e.userEmail,")"))});case 1:return e.a(2)}},e,this)})),function(){return p.apply(this,arguments)})},{key:"getGraphCalendars",value:(h=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,o,a,c,i,s,l,u,f,d,y,h,p,m;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.getGraphAccessToken();case 1:return n=e.v,console.log("🔐 Graph access token obtained, fetching calendars..."),e.n=2,fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 2:if((r=e.v).ok){e.n=3;break}throw new Error("Profile API failed: ".concat(r.status));case 3:return e.n=4,r.json();case 4:return t=e.v,o=t.mail||t.userPrincipalName,console.log("👤 Primary user: ".concat(t.displayName," (").concat(o,")")),e.n=5,fetch("https://graph.microsoft.com/v1.0/me/calendars?$select=id,name,canEdit,isDefaultCalendar,owner",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 5:if((a=e.v).ok){e.n=7;break}return e.n=6,a.text();case 6:throw c=e.v,console.error("Calendar API error response:",c),new Error("Calendar API failed: ".concat(a.status," - ").concat(c));case 7:return e.n=8,a.json();case 8:if(i=e.v,console.log("📊 Raw Graph calendar response:",i),i.value&&0!==i.value.length){e.n=9;break}return console.warn("⚠️ No calendars found in Graph response"),e.a(2,[]);case 9:return s=[],e.p=10,e.n=11,fetch("https://graph.microsoft.com/v1.0/me/calendarGroups?$expand=calendars",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 11:if(!(l=e.v).ok){e.n=13;break}return e.n=12,l.json();case 12:f=e.v,console.log("📂 Calendar groups found:",f),null===(u=f.value)||void 0===u||u.forEach(function(e){e.calendars&&s.push.apply(s,_toConsumableArray(e.calendars))});case 13:e.n=15;break;case 14:e.p=14,p=e.v,console.log("ℹ️ Calendar groups not accessible (normal for some accounts):",p.message);case 15:return d=[].concat(_toConsumableArray(i.value),s),y=d.filter(function(e,n,r){return n===r.findIndex(function(n){return n.id===e.id})}),console.log("📅 Found ".concat(y.length," total calendars (").concat(i.value.length," primary + ").concat(s.length," from groups)")),h=y.map(function(e){var n,r=(null===(n=e.owner)||void 0===n||null===(n=n.emailAddress)||void 0===n?void 0:n.address)||o;return{id:e.id,name:e.name||"Unnamed Calendar",userEmail:r,type:"Microsoft Graph",syncEnabled:!0,canEdit:!1!==e.canEdit,isDefaultCalendar:e.isDefaultCalendar||!1}}),console.log("✅ Processed calendars:"),h.forEach(function(e){console.log('  📅 "'.concat(e.name,'" owned by ').concat(e.userEmail," (Default: ").concat(e.isDefaultCalendar,", Editable: ").concat(e.canEdit,")"))}),e.a(2,h);case 16:throw e.p=16,m=e.v,console.error("❌ getGraphCalendars failed:",m),console.log("🔄 Will attempt alternative discovery or fall back to mock data"),m;case 17:return e.a(2)}},e,this,[[10,14],[0,16]])})),function(){return h.apply(this,arguments)})},{key:"getGraphAccessToken",value:(y=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,o,a,c;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,console.log("🔐 Requesting Graph access token..."),console.log("🔍 Checking Office.js availability:"),console.log("  - Office object:","undefined"==typeof Office?"undefined":_typeof(Office)),console.log("  - Office.context:",_typeof(null===(n=Office)||void 0===n?void 0:n.context)),console.log("  - Office.context.auth:",_typeof(null===(r=Office)||void 0===r||null===(r=r.context)||void 0===r?void 0:r.auth)),console.log("  - getAccessToken method:",_typeof(null===(t=Office)||void 0===t||null===(t=t.context)||void 0===t||null===(t=t.auth)||void 0===t?void 0:t.getAccessToken)),null!==(o=Office)&&void 0!==o&&null!==(o=o.context)&&void 0!==o&&o.host&&(console.log("🏢 Host application:",Office.context.host),console.log("📱 Platform:",Office.context.platform),console.log("🔧 Requirements:",Office.context.requirements)),null!==(a=Office)&&void 0!==a&&null!==(a=a.context)&&void 0!==a&&null!==(a=a.auth)&&void 0!==a&&a.getAccessToken){e.n=2;break}if(console.warn("⚠️ Office.js authentication not available in this context"),console.log("🔄 Attempting alternative authentication methods..."),"undefined"==typeof window||!window.location){e.n=1;break}throw console.log("🌐 Running in web context:",window.location.href),new Error("Office.js SSO not available - add-in may need to be loaded in proper Office context");case 1:throw new Error("Office.js authentication not available in this context");case 2:return console.log("✅ Office.js authentication is available, requesting token..."),e.a(2,new Promise(function(e,n){var r={allowSignInPrompt:!0,allowConsentPrompt:!0,forMSGraphAccess:!0};console.log("📋 Token request options:",r),Office.context.auth.getAccessToken(r,function(r){if(console.log("🔍 Auth result status:",r.status),console.log("🔍 Full auth result:",r),r.status===Office.AsyncResultStatus.Succeeded)console.log("✅ Access token obtained successfully"),console.log("🎫 Token preview:",r.value.substring(0,20)+"..."),console.log("🎫 Token length:",r.value.length),e(r.value);else{var t,o,a,c,i,s,l,u,f,d,y;console.error("❌ Authentication failed:",r.error),console.error("Error code:",null===(t=r.error)||void 0===t?void 0:t.code),console.error("Error message:",null===(o=r.error)||void 0===o?void 0:o.message),console.error("Error name:",null===(a=r.error)||void 0===a?void 0:a.name),console.error("Error tracing:",null===(c=r.error)||void 0===c?void 0:c.tracing);var h="Authentication failed: ".concat((null===(i=r.error)||void 0===i?void 0:i.message)||"Unknown error");13001===(null===(s=r.error)||void 0===s?void 0:s.code)?h+=" (User not signed in - this may require signing into Office)":13002===(null===(l=r.error)||void 0===l?void 0:l.code)?h+=" (User consent required - admin may need to grant permissions)":13003===(null===(u=r.error)||void 0===u?void 0:u.code)?h+=" (Invalid audience - token scope issue)":13006===(null===(f=r.error)||void 0===f?void 0:f.code)?h+=" (Invalid request - check add-in manifest permissions)":13007===(null===(d=r.error)||void 0===d?void 0:d.code)?h+=" (Invalid grant - user may need to re-authenticate)":13012===(null===(y=r.error)||void 0===y?void 0:y.code)&&(h+=" (Add-in not trusted - may need admin consent)"),n(new Error(h))}})}));case 3:throw e.p=3,c=e.v,console.error("❌ Failed to get Graph access token:",c),console.log("💡 Troubleshooting suggestions:"),console.log("  1. Ensure add-in is loaded in Outlook (not just web browser)"),console.log("  2. Check that manifest is properly deployed"),console.log("  3. Verify Office.js is fully loaded"),console.log("  4. Check manifest WebApplicationInfo configuration"),new Error("Authentication setup failed: ".concat(c.message));case 4:return e.a(2)}},e,null,[[0,3]])})),function(){return y.apply(this,arguments)})},{key:"discoverMockCalendars",value:(d=_asyncToGenerator(_regenerator().m(function e(){var n,r=this;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:n=[{id:"calendar-1",name:"Primary Work Calendar",userEmail:"user@company1.com",type:"Exchange",syncEnabled:!0,isDefaultCalendar:!0},{id:"calendar-2",name:"Secondary Work Calendar",userEmail:"user@company2.com",type:"Office 365",syncEnabled:!0,isDefaultCalendar:!1},{id:"calendar-3",name:"Personal Calendar",userEmail:"personal@outlook.com",type:"Outlook.com",syncEnabled:!0,isDefaultCalendar:!1}],this.calendars.clear(),n.forEach(function(e){r.calendars.set(e.id,e)}),console.log("Using mock calendars for testing");case 1:return e.a(2)}},e,this)})),function(){return d.apply(this,arguments)})},{key:"getAvailableCalendars",value:(f=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,Array.from(this.calendars.values()))},e,this)})),function(){return f.apply(this,arguments)})},{key:"toggleCalendarSync",value:(u=_asyncToGenerator(_regenerator().m(function e(n){var r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(r=this.calendars.get(n)){e.n=1;break}throw new Error("Calendar not found");case 1:return r.syncEnabled=!r.syncEnabled,this.saveConfiguration(),console.log("Calendar sync ".concat(r.syncEnabled?"enabled":"disabled"," for ").concat(r.name)),e.a(2,r.syncEnabled)}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"performSync",value:(l=_asyncToGenerator(_regenerator().m(function e(){var n,r,t,o,a,c,i,s=arguments;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=s.length>0&&void 0!==s[0]?s[0]:null,!this.syncInProgress){e.n=1;break}throw new Error("Sync already in progress");case 1:if(this.syncInProgress=!0,e.p=2,r=n||new Date,console.log("Starting calendar synchronization for ".concat(r.toLocaleDateString(),"...")),new Date(r).setHours(0,0,0,0),new Date(r).setHours(23,59,59,999),!((t=Array.from(this.calendars.values()).filter(function(e){return e.syncEnabled})).length<2)){e.n=3;break}throw new Error("At least 2 calendars must be enabled for synchronization");case 3:return e.n=4,this.getBusyTimesFromCalendars(t);case 4:return o=e.v,e.n=5,this.removeExistingSyncBlocks(t);case 5:return a=e.v,e.n=6,this.createSyncBlocks(t,o);case 6:return c=e.v,this.lastSync=new Date,console.log("Sync completed: ".concat(c," blocks created, ").concat(a," blocks removed")),e.a(2,{blocksCreated:c,blocksRemoved:a,syncTime:this.lastSync});case 7:throw e.p=7,i=e.v,console.error("Sync failed:",i),i;case 8:return e.p=8,this.syncInProgress=!1,e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(){return l.apply(this,arguments)})},{key:"getBusyTimesFromCalendars",value:(s=_asyncToGenerator(_regenerator().m(function e(n){var r,t,o,a,c,i,s,l;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:r=new Map,t=_createForOfIteratorHelper(n),e.p=1,t.s();case 2:if((o=t.n()).done){e.n=8;break}return a=o.value,e.p=3,console.log("Fetching busy times for ".concat(a.name," (").concat(a.userEmail,")")),e.n=4,this.getRealBusyTimes(a);case 4:c=e.v,r.set(a.id,c),console.log("Found ".concat(c.length," busy times in ").concat(a.name)),e.n=7;break;case 5:return e.p=5,s=e.v,console.warn("Failed to get busy times for ".concat(a.name,":"),s),e.n=6,this.simulateGetBusyTimes(a);case 6:i=e.v,r.set(a.id,i);case 7:e.n=2;break;case 8:e.n=10;break;case 9:e.p=9,l=e.v,t.e(l);case 10:return e.p=10,t.f(),e.f(10);case 11:return e.a(2,r)}},e,this,[[3,5],[1,9,10,11]])})),function(e){return s.apply(this,arguments)})},{key:"getRealBusyTimes",value:(i=_asyncToGenerator(_regenerator().m(function e(n){var r,t,o,a,c,i,s,l;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.getGraphAccessToken();case 1:return r=e.v,t=this.targetDate||new Date,(o=new Date(t)).setHours(0,0,0,0),(a=new Date(t)).setHours(23,59,59,999),c="https://graph.microsoft.com/v1.0/me/calendars/".concat(n.id,"/events")+"?$filter=start/dateTime ge '".concat(o.toISOString(),"' and end/dateTime le '").concat(a.toISOString(),"'")+"&$select=subject,start,end,showAs,isPrivate",e.n=2,fetch(c,{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});case 2:if((i=e.v).ok){e.n=3;break}throw new Error("Graph API error: ".concat(i.status," ").concat(i.statusText));case 3:return e.n=4,i.json();case 4:return s=e.v,e.a(2,s.value.filter(function(e){return"busy"===e.showAs||"tentative"===e.showAs}).map(function(e){return{start:new Date(e.start.dateTime),end:new Date(e.end.dateTime),subject:e.isPrivate?"[Private]":e.subject||"[No Subject]",isPrivate:e.isPrivate||!1}}));case 5:throw e.p=5,l=e.v,console.error("Graph API call failed for ".concat(n.name,":"),l),l;case 6:return e.a(2)}},e,this,[[0,5]])})),function(e){return i.apply(this,arguments)})},{key:"simulateGetBusyTimes",value:(c=_asyncToGenerator(_regenerator().m(function e(n){var r,t,o,a,c,i;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(e){return setTimeout(e,100)});case 1:for(r=new Date,t=[],o=0;o<Math.floor(5*Math.random())+1;o++)a=new Date(r.getTime()+7*Math.random()*24*60*60*1e3),c=60*(3*Math.random()+.5)*60*1e3,i=new Date(a.getTime()+c),t.push({start:a,end:i,subject:"Meeting in ".concat(n.name),isPrivate:!1});return e.a(2,t)}},e)})),function(e){return c.apply(this,arguments)})},{key:"removeExistingSyncBlocks",value:(a=_asyncToGenerator(_regenerator().m(function e(n){var r,t,o,a,c,i,s;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:r=0,t=_createForOfIteratorHelper(n),e.p=1,t.s();case 2:if((o=t.n()).done){e.n=7;break}return a=o.value,e.p=3,e.n=4,this.simulateRemoveSyncBlocks(a);case 4:c=e.v,r+=c,e.n=6;break;case 5:e.p=5,i=e.v,console.warn("Failed to remove sync blocks from ".concat(a.name,":"),i);case 6:e.n=2;break;case 7:e.n=9;break;case 8:e.p=8,s=e.v,t.e(s);case 9:return e.p=9,t.f(),e.f(9);case 10:return e.a(2,r)}},e,this,[[3,5],[1,8,9,10]])})),function(e){return a.apply(this,arguments)})},{key:"simulateRemoveSyncBlocks",value:(o=_asyncToGenerator(_regenerator().m(function e(n){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(e){return setTimeout(e,50)});case 1:return e.a(2,Math.floor(3*Math.random()))}},e)})),function(e){return o.apply(this,arguments)})},{key:"createSyncBlocks",value:(t=_asyncToGenerator(_regenerator().m(function e(n,r){var t,o,a,c,i,s,l,u,f,d,y,h,p;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:t=0,o=_createForOfIteratorHelper(n),e.p=1,o.s();case 2:if((a=o.n()).done){e.n=7;break}c=a.value,e.p=3,i=[],s=_createForOfIteratorHelper(r);try{for(s.s();!(l=s.n()).done;)u=_slicedToArray(l.value,2),f=u[0],d=u[1],f!==c.id&&i.push.apply(i,_toConsumableArray(d))}catch(e){s.e(e)}finally{s.f()}return e.n=4,this.simulateCreateSyncBlocks(c,i);case 4:y=e.v,t+=y,e.n=6;break;case 5:e.p=5,h=e.v,console.warn("Failed to create sync blocks in ".concat(c.name,":"),h);case 6:e.n=2;break;case 7:e.n=9;break;case 8:e.p=8,p=e.v,o.e(p);case 9:return e.p=9,o.f(),e.f(9);case 10:return e.a(2,t)}},e,this,[[3,5],[1,8,9,10]])})),function(e,n){return t.apply(this,arguments)})},{key:"simulateCreateSyncBlocks",value:(r=_asyncToGenerator(_regenerator().m(function e(n,r){var t,o;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.createRealSyncBlocks(n,r);case 1:return e.a(2,e.v);case 2:return e.p=2,o=e.v,console.warn("Graph API failed, simulating for ".concat(n.name,":"),o),e.n=3,new Promise(function(e){return setTimeout(e,100)});case 3:return t=n.userEmail?"".concat(n.name," (").concat(n.userEmail,")"):n.name,console.log("Would create ".concat(r.length," sync blocks in ").concat(t)),e.a(2,r.length)}},e,this,[[0,2]])})),function(e,n){return r.apply(this,arguments)})},{key:"createRealSyncBlocks",value:(n=_asyncToGenerator(_regenerator().m(function e(n,r){var t,o,a,c,i,s,l,u,f;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,this.getGraphAccessToken();case 1:t=e.v,o=0,a=_createForOfIteratorHelper(r),e.p=2,a.s();case 3:if((c=a.n()).done){e.n=8;break}return i=c.value,e.p=4,s={subject:this.config.busyBlockSubject,start:{dateTime:i.start.toISOString(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},end:{dateTime:i.end.toISOString(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},showAs:"busy",isPrivate:!0,categories:[this.config.busyBlockCategory],body:{contentType:"text",content:"Auto-synchronized busy time from another calendar"}},e.n=5,fetch("https://graph.microsoft.com/v1.0/me/calendars/".concat(n.id,"/events"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(s)});case 5:(l=e.v).ok?(o++,console.log("Created sync block in ".concat(n.name,": ").concat(i.start.toLocaleTimeString()," - ").concat(i.end.toLocaleTimeString()))):console.warn("Failed to create sync block in ".concat(n.name,": ").concat(l.status)),e.n=7;break;case 6:e.p=6,u=e.v,console.error("Error creating sync block in ".concat(n.name,":"),u);case 7:e.n=3;break;case 8:e.n=10;break;case 9:e.p=9,f=e.v,a.e(f);case 10:return e.p=10,a.f(),e.f(10);case 11:return console.log("Created ".concat(o," real sync blocks in ").concat(n.name," (").concat(n.userEmail,")")),e.a(2,o)}},e,this,[[4,6],[2,9,10,11]])})),function(e,r){return n.apply(this,arguments)})},{key:"startAutoSync",value:function(){var e=this;this.syncInterval&&clearInterval(this.syncInterval);var n=60*this.config.syncIntervalMinutes*1e3;this.syncInterval=setInterval(function(){e.performSync().catch(function(e){console.error("Auto-sync failed:",e)})},n),console.log("Auto-sync started with ".concat(this.config.syncIntervalMinutes," minute interval"))}},{key:"stopAutoSync",value:function(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null,console.log("Auto-sync stopped"))}},{key:"getSyncStatus",value:(e=_asyncToGenerator(_regenerator().m(function e(){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(!this.syncInProgress){e.n=1;break}return e.a(2,{state:"Syncing",message:"Synchronization in progress...",lastSync:this.lastSync});case 1:if(this.syncEnabled){e.n=2;break}return e.a(2,{state:"Stopped",message:"Synchronization disabled",lastSync:this.lastSync});case 2:if(!((n=Array.from(this.calendars.values()).filter(function(e){return e.syncEnabled}).length)<2)){e.n=3;break}return e.a(2,{state:"Error",message:"Need at least 2 enabled calendars",lastSync:this.lastSync});case 3:return e.a(2,{state:"Active",message:"Monitoring ".concat(n," calendars"),lastSync:this.lastSync})}},e,this)})),function(){return e.apply(this,arguments)})},{key:"setSyncInterval",value:function(e){this.config.syncIntervalMinutes=e,this.saveConfiguration(),this.syncInterval&&this.startAutoSync()}},{key:"setBusyBlockSubject",value:function(e){this.config.busyBlockSubject=e,this.saveConfiguration()}},{key:"setLookAheadDays",value:function(e){this.config.lookAheadDays=e,this.saveConfiguration()}},{key:"getConfiguration",value:function(){return _objectSpread({},this.config)}}]);var e,n,r,t,o,a,c,i,s,l,u,f,d,y,h,p,m,v,g,b}();