/*! For license information please see dc73e06fbf5d268837ba.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,c,i=[],s=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){u=!0,a=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw a}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var s=r&&r.prototype instanceof i?r:i,u=Object.create(s.prototype);return _regeneratorDefine2(u,"_invoke",function(n,r,a){var o,i,s,u=0,l=a||[],f=!1,d={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return o=t,i=0,s=e,d.n=n,c}};function h(n,r){for(i=n,s=r,t=0;!f&&u&&!a&&t<l.length;t++){var a,o=l[t],h=d.p,p=o[2];n>3?(a=p===r)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=h&&((a=n<2&&h<o[1])?(i=0,d.v=r,d.n=o[1]):h<p&&(a=n<3||o[0]>r||r>p)&&(o[4]=n,o[5]=r,d.n=p,i=0))}if(a||n>1)return c;throw f=!0,r}return function(a,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&h(l,p),i=l,s=p;(t=i<2?e:s)||!f;){o||(i?i<3?(i>1&&(d.n=-1),h(i,s)):d.n=s:d.v=s);try{if(u=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=d.n<0)?s:n.call(r,d))!==c)break}catch(t){o=e,i=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,a,o),!0),u}var c={};function i(){}function s(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,function(){return this}),t),f=u.prototype=i.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,_regeneratorDefine2(f,"constructor",u),_regeneratorDefine2(u,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(u,a,"GeneratorFunction"),_regeneratorDefine2(f),_regeneratorDefine2(f,a,"Generator"),_regeneratorDefine2(f,r,function(){return this}),_regeneratorDefine2(f,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:d}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,a,o,c){try{var i=e[o](c),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function c(e){asyncGeneratorStep(o,r,a,c,i,"next",e)}function i(e){asyncGeneratorStep(o,r,a,c,i,"throw",e)}c(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}export var MultiTenantCalendarManager=function(){return _createClass(function e(){_classCallCheck(this,e),this.connectedAccounts=new Map,this.authTokens=new Map,this.calendarCache=new Map,this.syncInProgress=!1,this.accountTypes={OFFICE365:"office365",EXCHANGE:"exchange",GMAIL:"gmail",OUTLOOK_COM:"outlook_com",OTHER:"other"}},[{key:"addAccount",value:(l=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o,c,i,s,u,l;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=t.id,r=t.type,a=t.email,o=t.displayName,c=t.tenantId,i=t.clientId,s=t.authUrl,u=t.calendarUrl,console.log("ðŸ”— Adding account: ".concat(o," (").concat(a,")")),l={id:n,type:r,email:a,displayName:o,tenantId:c,clientId:i,authUrl:s,calendarUrl:u,isAuthenticated:!1,calendars:[],lastSync:null,syncEnabled:!0},this.connectedAccounts.set(n,l),e.n=1,this.authenticateAccount(n);case 1:return e.a(2,l)}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"authenticateAccount",value:(u=_asyncToGenerator(_regenerator().m(function e(t){var n,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(n=this.connectedAccounts.get(t)){e.n=1;break}throw new Error("Account ".concat(t," not found"));case 1:console.log("ðŸ” Authenticating ".concat(n.displayName,"...")),r=n.type,e.n=r===this.accountTypes.OFFICE365?2:r===this.accountTypes.GMAIL?4:r===this.accountTypes.OUTLOOK_COM?6:r===this.accountTypes.EXCHANGE?8:10;break;case 2:return e.n=3,this.authenticateOffice365(n);case 3:case 5:case 7:case 9:return e.a(2,e.v);case 4:return e.n=5,this.authenticateGmail(n);case 6:return e.n=7,this.authenticateOutlookCom(n);case 8:return e.n=9,this.authenticateExchange(n);case 10:throw new Error("Unsupported account type: ".concat(n.type));case 11:return e.a(2)}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"authenticateOffice365",value:(s=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o,c;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n="https://login.microsoftonline.com/".concat(t.tenantId,"/oauth2/v2.0/authorize"),r=new URLSearchParams({client_id:t.clientId,response_type:"code",redirect_uri:"".concat(window.location.origin,"/auth-callback"),scope:"https://graph.microsoft.com/Calendars.ReadWrite https://graph.microsoft.com/User.Read",state:t.id,prompt:"login"}),a="".concat(n,"?").concat(r.toString()),e.n=1,this.openAuthPopup(a,t.id);case 1:if(!(o=e.v).access_token){e.n=3;break}return this.authTokens.set(t.id,{access_token:o.access_token,refresh_token:o.refresh_token,expires_at:Date.now()+1e3*o.expires_in}),t.isAuthenticated=!0,e.n=2,this.discoverAccountCalendars(t.id);case 2:return e.a(2,!0);case 3:throw new Error("Failed to get access token");case 4:throw e.p=4,c=e.v,console.error("âŒ Office 365 auth failed for ".concat(t.email,":"),c),c;case 5:return e.a(2)}},e,this,[[0,4]])})),function(e){return s.apply(this,arguments)})},{key:"authenticateGmail",value:(i=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=new URLSearchParams({client_id:t.clientId,response_type:"code",redirect_uri:"".concat(window.location.origin,"/auth-callback"),scope:"https://www.googleapis.com/auth/calendar",access_type:"offline",prompt:"consent",state:t.id}),r="".concat("https://accounts.google.com/o/oauth2/auth","?").concat(n.toString()),e.n=1,this.openAuthPopup(r,t.id);case 1:if(!(a=e.v).access_token){e.n=3;break}return this.authTokens.set(t.id,a),t.isAuthenticated=!0,e.n=2,this.discoverAccountCalendars(t.id);case 2:return e.a(2,!0);case 3:throw new Error("Gmail authentication failed");case 4:throw e.p=4,o=e.v,console.error("âŒ Gmail auth failed for ".concat(t.email,":"),o),o;case 5:return e.a(2)}},e,this,[[0,4]])})),function(e){return i.apply(this,arguments)})},{key:"authenticateOutlookCom",value:(c=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=new URLSearchParams({client_id:t.clientId,response_type:"code",redirect_uri:"".concat(window.location.origin,"/auth-callback"),scope:"https://graph.microsoft.com/Calendars.ReadWrite https://graph.microsoft.com/User.Read",state:t.id}),r="".concat("https://login.microsoftonline.com/common/oauth2/v2.0/authorize","?").concat(n.toString()),e.n=1,this.openAuthPopup(r,t.id);case 1:if(!(a=e.v).access_token){e.n=3;break}return this.authTokens.set(t.id,a),t.isAuthenticated=!0,e.n=2,this.discoverAccountCalendars(t.id);case 2:return e.a(2,!0);case 3:throw new Error("Outlook.com authentication failed");case 4:throw e.p=4,o=e.v,console.error("âŒ Outlook.com auth failed for ".concat(t.email,":"),o),o;case 5:return e.a(2)}},e,this,[[0,4]])})),function(e){return c.apply(this,arguments)})},{key:"authenticateExchange",value:(o=_asyncToGenerator(_regenerator().m(function e(t){var n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("ðŸ” Exchange authentication for ".concat(t.email," not yet implemented")),t.isAuthenticated=!1,e.a(2,!1);case 1:throw e.p=1,n=e.v,console.error("âŒ Exchange auth failed for ".concat(t.email,":"),n),n;case 2:return e.a(2)}},e,null,[[0,1]])})),function(e){return o.apply(this,arguments)})},{key:"openAuthPopup",value:(a=_asyncToGenerator(_regenerator().m(function e(t,n){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,r){var a=window.open(t,"auth_".concat(n),"width=500,height=600,scrollbars=yes,resizable=yes"),o=function(t){t.origin===window.location.origin&&("AUTH_SUCCESS"===t.data.type&&t.data.accountId===n?(window.removeEventListener("message",o),a.close(),e(t.data.tokens)):"AUTH_ERROR"===t.data.type&&t.data.accountId===n&&(window.removeEventListener("message",o),a.close(),r(new Error(t.data.error))))};window.addEventListener("message",o);var c=setInterval(function(){a.closed&&(clearInterval(c),window.removeEventListener("message",o),r(new Error("Authentication was cancelled")))},1e3);setTimeout(function(){a.closed||(a.close(),clearInterval(c),window.removeEventListener("message",o),r(new Error("Authentication timeout")))},3e5)}))},e)})),function(e,t){return a.apply(this,arguments)})},{key:"discoverAccountCalendars",value:(r=_asyncToGenerator(_regenerator().m(function e(t){var n,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if((n=this.connectedAccounts.get(t))&&n.isAuthenticated){e.n=1;break}throw new Error("Account ".concat(t," not authenticated"));case 1:console.log("ðŸ“… Discovering calendars for ".concat(n.email,"...")),r=n.type,e.n=r===this.accountTypes.OFFICE365||r===this.accountTypes.OUTLOOK_COM?2:r===this.accountTypes.GMAIL?4:r===this.accountTypes.EXCHANGE?6:8;break;case 2:return e.n=3,this.getGraphCalendars(t);case 3:case 5:case 7:return e.a(2,e.v);case 4:return e.n=5,this.getGmailCalendars(t);case 6:return e.n=7,this.getExchangeCalendars(t);case 8:throw new Error("Calendar discovery not supported for ".concat(n.type));case 9:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getGraphCalendars",value:(n=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o,c;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=this.connectedAccounts.get(t),(r=this.authTokens.get(t))&&r.access_token){e.n=1;break}throw new Error("No access token for account ".concat(t));case 1:return e.p=1,e.n=2,fetch("https://graph.microsoft.com/v1.0/me/calendars",{headers:{Authorization:"Bearer ".concat(r.access_token),"Content-Type":"application/json"}});case 2:if((a=e.v).ok){e.n=3;break}throw new Error("Graph API error: ".concat(a.status," ").concat(a.statusText));case 3:return e.n=4,a.json();case 4:return o=e.v,n.calendars=o.value.map(function(e){return{id:e.id,name:e.name,isDefault:e.isDefaultCalendar,canEdit:e.canEdit,owner:e.owner,syncEnabled:e.isDefaultCalendar}}),console.log("ðŸ“… Found ".concat(n.calendars.length," calendars for ").concat(n.email)),e.a(2,n.calendars);case 5:throw e.p=5,c=e.v,console.error("âŒ Failed to get Graph calendars for ".concat(n.email,":"),c),c;case 6:return e.a(2)}},e,this,[[1,5]])})),function(e){return n.apply(this,arguments)})},{key:"getGmailCalendars",value:(t=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o,c;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=this.connectedAccounts.get(t),(r=this.authTokens.get(t))&&r.access_token){e.n=1;break}throw new Error("No access token for account ".concat(t));case 1:return e.p=1,e.n=2,fetch("https://www.googleapis.com/calendar/v3/users/me/calendarList",{headers:{Authorization:"Bearer ".concat(r.access_token),"Content-Type":"application/json"}});case 2:if((a=e.v).ok){e.n=3;break}throw new Error("Google Calendar API error: ".concat(a.status," ").concat(a.statusText));case 3:return e.n=4,a.json();case 4:return o=e.v,n.calendars=o.items.map(function(e){return{id:e.id,name:e.summary,isDefault:e.primary,canEdit:"owner"===e.accessRole||"writer"===e.accessRole,owner:{name:e.summary,address:e.id},syncEnabled:e.primary}}),console.log("ðŸ“… Found ".concat(n.calendars.length," Gmail calendars for ").concat(n.email)),e.a(2,n.calendars);case 5:throw e.p=5,c=e.v,console.error("âŒ Failed to get Gmail calendars for ".concat(n.email,":"),c),c;case 6:return e.a(2)}},e,this,[[1,5]])})),function(e){return t.apply(this,arguments)})},{key:"getExchangeCalendars",value:(e=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)if(0===e.n)return console.log("ðŸ“… Exchange calendar discovery for ".concat(t," not yet implemented")),e.a(2,[])},e)})),function(t){return e.apply(this,arguments)})},{key:"getAccountsSummary",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.connectedAccounts);try{for(n.s();!(e=n.n()).done;){var r=_slicedToArray(e.value,2),a=r[0],o=r[1];t.push({id:a,email:o.email,displayName:o.displayName,type:o.type,isAuthenticated:o.isAuthenticated,calendarCount:o.calendars.length,syncEnabled:o.syncEnabled,lastSync:o.lastSync})}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"createMockAccounts",value:function(){var e=this;return[{id:"tenant-a",type:this.accountTypes.OFFICE365,email:"dan.hookham@tenanta.com",displayName:"Dan Hookham (Tenant A)",tenantId:"tenant-a-guid",clientId:"client-a-guid"},{id:"tenant-b",type:this.accountTypes.OFFICE365,email:"dan.hookham@tenantb.com",displayName:"Dan Hookham (Tenant B)",tenantId:"tenant-b-guid",clientId:"client-b-guid"},{id:"tenant-c",type:this.accountTypes.OFFICE365,email:"dan.hookham@tenantc.com",displayName:"Dan Hookham (Tenant C)",tenantId:"tenant-c-guid",clientId:"client-c-guid"},{id:"gmail-personal",type:this.accountTypes.GMAIL,email:"dan.hookham@gmail.com",displayName:"Dan Hookham (Gmail)",clientId:"gmail-client-id"},{id:"outlook-personal",type:this.accountTypes.OUTLOOK_COM,email:"dan.hookham@outlook.com",displayName:"Dan Hookham (Personal)",clientId:"outlook-client-id"}].forEach(function(t){var n=_objectSpread({},t);n.isAuthenticated=!0,n.calendars=[{id:"".concat(t.id,"-default"),name:"Calendar",isDefault:!0,canEdit:!0,syncEnabled:!0}],n.lastSync=new Date,n.syncEnabled=!0,e.connectedAccounts.set(n.id,n)}),console.log("ðŸ“Š Created mock accounts for testing"),this.getAccountsSummary()}}]);var e,t,n,r,a,o,c,i,s,u,l}();window.multiTenantManager=new MultiTenantCalendarManager;