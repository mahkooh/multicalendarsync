/*! For license information please see 9dc77d9f3cd66a63616d.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regenerator(){var e,n,t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.toStringTag||"@@toStringTag";function a(t,o,r,a){var s=o&&o.prototype instanceof i?o:i,l=Object.create(s.prototype);return _regeneratorDefine2(l,"_invoke",function(t,o,r){var a,i,s,l=0,u=r||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(n,t){return a=n,i=0,s=e,d.n=t,c}};function p(t,o){for(i=t,s=o,n=0;!f&&l&&!r&&n<u.length;n++){var r,a=u[n],p=d.p,h=a[2];t>3?(r=h===o)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((r=t<2&&p<a[1])?(i=0,d.v=o,d.n=a[1]):p<h&&(r=t<3||a[0]>o||o>h)&&(a[4]=t,a[5]=o,d.n=h,i=0))}if(r||t>1)return c;throw f=!0,o}return function(r,u,h){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&p(u,h),i=u,s=h;(n=i<2?e:s)||!f;){a||(i?i<3?(i>1&&(d.n=-1),p(i,s)):d.n=s:d.v=s);try{if(l=2,a){if(i||(r="next"),n=a[r]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),i=1);a=e}else if((n=(f=d.n<0)?s:t.call(o,d))!==c)break}catch(n){a=e,i=1,s=n}finally{l=1}}return{value:n,done:f}}}(t,r,a),!0),l}var c={};function i(){}function s(){}function l(){}n=Object.getPrototypeOf;var u=[][o]?n(n([][o]())):(_regeneratorDefine2(n={},o,function(){return this}),n),f=l.prototype=i.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=l,_regeneratorDefine2(f,"constructor",l),_regeneratorDefine2(l,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(l,r,"GeneratorFunction"),_regeneratorDefine2(f),_regeneratorDefine2(f,r,"Generator"),_regeneratorDefine2(f,o,function(){return this}),_regeneratorDefine2(f,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:d}})()}function _regeneratorDefine2(e,n,t,o){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}_regeneratorDefine2=function(e,n,t,o){function a(n,t){_regeneratorDefine2(e,n,function(e){return this._invoke(n,t,e)})}n?r?r(e,n,{value:t,enumerable:!o,configurable:!o,writable:!o}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,n,t,o)}function asyncGeneratorStep(e,n,t,o,r,a,c){try{var i=e[a](c),s=i.value}catch(e){return void t(e)}i.done?n(s):Promise.resolve(s).then(o,r)}function _asyncToGenerator(e){return function(){var n=this,t=arguments;return new Promise(function(o,r){var a=e.apply(n,t);function c(e){asyncGeneratorStep(a,o,r,c,i,"next",e)}function i(e){asyncGeneratorStep(a,o,r,c,i,"throw",e)}c(void 0)})}}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var n=_toPrimitive(e,"string");return"symbol"==_typeof(n)?n:n+""}function _toPrimitive(e,n){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}var CalendarDiscoveryDiagnostic=function(){return _createClass(function e(){_classCallCheck(this,e),this.results={graphCalendars:[],outlookAccounts:[],connectedAccounts:[],errors:[]}},[{key:"runFullDiagnostic",value:(t=_asyncToGenerator(_regenerator().m(function e(){var n,t,o,r,a,c;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return console.log("🔍 Starting comprehensive calendar discovery diagnostic..."),t=(new Date).toISOString(),o=this.getOfficeContext(),e.n=1,this.testGraphAPI();case 1:return r=e.v,a=this.getOutlookContext(),c=this.checkLocalStorage(),n={timestamp:t,officeContext:o,graphApiResults:r,outlookContext:a,localStorageData:c,recommendations:[]},this.generateRecommendations(n),this.displayResults(n),e.a(2,n)}},e,this)})),function(){return t.apply(this,arguments)})},{key:"getOfficeContext",value:function(){try{var e,n,t,o,r;if(!Office||!Office.context)return{available:!1,error:"Office context not available"};var a=null===(e=Office.context.mailbox)||void 0===e?void 0:e.diagnostics;return{available:!0,hostName:null==a?void 0:a.hostName,hostVersion:null==a?void 0:a.hostVersion,platform:null==a?void 0:a.platform,outlookVersion:null==a?void 0:a.outlookVersion,ewsUrl:null===(n=Office.context.mailbox)||void 0===n?void 0:n.ewsUrl,userEmail:null===(t=Office.context.mailbox)||void 0===t||null===(t=t.userProfile)||void 0===t?void 0:t.emailAddress,userName:null===(o=Office.context.mailbox)||void 0===o||null===(o=o.userProfile)||void 0===o?void 0:o.displayName,timeZone:null===(r=Office.context.mailbox)||void 0===r||null===(r=r.userProfile)||void 0===r?void 0:r.timeZone,authenticationCapable:!!Office.context.auth}}catch(e){return{available:!1,error:e.message,fallbackData:{officeAvailable:!!window.Office,location:window.location.href}}}}},{key:"testGraphAPI",value:(n=_asyncToGenerator(_regenerator().m(function e(){var n,t,o,r,a,c,i,s,l,u,f,d;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return n={accessTokenObtained:!1,userProfileSuccess:!1,calendarsSuccess:!1,calendarsFound:[],errors:[]},e.p=1,console.log("🔐 Testing Graph API access token..."),e.n=2,this.getGraphAccessToken();case 2:return t=e.v,n.accessTokenObtained=!0,console.log("✅ Access token obtained"),console.log("👤 Testing user profile API..."),e.n=3,fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});case 3:if(!(o=e.v).ok){e.n=5;break}return e.n=4,o.json();case 4:r=e.v,n.userProfile=r,n.userProfileSuccess=!0,console.log("✅ User profile: ".concat(r.displayName," (").concat(r.mail||r.userPrincipalName,")")),e.n=6;break;case 5:throw new Error("Profile API failed: ".concat(o.status));case 6:return console.log("📅 Testing calendar discovery..."),e.n=7,fetch("https://graph.microsoft.com/v1.0/me/calendars?$select=id,name,canEdit,isDefaultCalendar,owner,canShare,canViewPrivateItems,changeKey,color",{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});case 7:if(!(a=e.v).ok){e.n=9;break}return e.n=8,a.json();case 8:c=e.v,n.calendarsSuccess=!0,n.calendarsFound=c.value||[],console.log("✅ Found ".concat(n.calendarsFound.length," calendars via Graph API")),n.calendarsFound.forEach(function(e,n){var t;console.log("  📅 ".concat(n+1,". ").concat(e.name," (").concat(e.id,")")),console.log("     - Default: ".concat(e.isDefaultCalendar)),console.log("     - Can Edit: ".concat(e.canEdit)),console.log("     - Owner: ".concat((null===(t=e.owner)||void 0===t?void 0:t.name)||"Unknown"))}),e.n=10;break;case 9:throw new Error("Calendar API failed: ".concat(a.status));case 10:return console.log("📮 Testing for additional mailboxes..."),e.p=11,e.n=12,fetch("https://graph.microsoft.com/v1.0/me/mailFolders",{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});case 12:if(!(i=e.v).ok){e.n=14;break}return e.n=13,i.json();case 13:u=e.v,n.mailboxInfo={foldersFound:(null===(s=u.value)||void 0===s?void 0:s.length)||0,rootFolders:(null===(l=u.value)||void 0===l?void 0:l.map(function(e){return e.displayName}))||[]};case 14:e.n=16;break;case 15:e.p=15,f=e.v,n.errors.push("Mailbox check failed: ".concat(f.message));case 16:e.n=18;break;case 17:e.p=17,d=e.v,n.errors.push(d.message),console.error("❌ Graph API test failed:",d);case 18:return e.a(2,n)}},e,this,[[11,15],[1,17]])})),function(){return n.apply(this,arguments)})},{key:"getGraphAccessToken",value:(e=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,n){var t;null!==(t=Office)&&void 0!==t&&null!==(t=t.context)&&void 0!==t&&null!==(t=t.auth)&&void 0!==t&&t.getAccessToken?Office.context.auth.getAccessToken({allowConsentPrompt:!0,forMSGraphAccess:!0},function(t){var o;t.status===Office.AsyncResultStatus.Succeeded?e(t.value):n(new Error("Authentication failed: ".concat((null===(o=t.error)||void 0===o?void 0:o.message)||"Unknown error")))}):n(new Error("Office.js authentication not available"))}))},e)})),function(){return e.apply(this,arguments)})},{key:"getOutlookContext",value:function(){try{var e;if(null===(e=Office)||void 0===e||null===(e=e.context)||void 0===e||!e.mailbox)return{available:!1};var n=Office.context.mailbox,t=n.userProfile;return{available:!0,primaryEmail:null==t?void 0:t.emailAddress,displayName:null==t?void 0:t.displayName,timeZone:null==t?void 0:t.timeZone,serverUrl:n.ewsUrl,limitationNote:"Connected accounts (Gmail, etc.) are not accessible via Office.js APIs"}}catch(e){return{available:!1,error:e.message}}}},{key:"checkLocalStorage",value:function(){try{var e=Object.keys(localStorage),n=e.filter(function(e){return e.includes("calendar")||e.includes("account")||e.includes("sync")});return{totalKeys:e.length,calendarRelatedKeys:n,syncConfig:localStorage.getItem("calendarSyncConfig"),lastSync:localStorage.getItem("lastSync")}}catch(e){return{available:!1,error:e.message}}}},{key:"generateRecommendations",value:function(e){var n=[];e.graphApiResults.accessTokenObtained?0===e.graphApiResults.calendarsFound.length?n.push({type:"warning",title:"No Calendars Found via Graph API",description:"Graph API authentication works but no calendars were found.",action:"Check if you have any calendars in your Office 365/Exchange account."}):n.push({type:"success",title:"Found ".concat(e.graphApiResults.calendarsFound.length," Calendar(s)"),description:"These are calendars accessible through Microsoft Graph API.",action:"These calendars can be synchronized automatically."}):n.push({type:"error",title:"Graph API Authentication Failed",description:"Cannot access Microsoft Graph API. This means we can only see mock calendars.",action:"Ensure the add-in is properly installed and has necessary permissions."}),n.push({type:"info",title:"Connected Account Limitation",description:"Calendars from connected accounts (Gmail, Yahoo, personal Outlook.com) added to Outlook app are not visible through Graph API.",action:"To sync these calendars, we need to add manual calendar connection features."}),e.graphApiResults.calendarsFound.length<5&&n.push({type:"suggestion",title:"Add More Calendar Sources",description:"To sync your 5 calendars across multiple accounts, we need to add support for additional calendar services.",action:"Consider implementing Google Calendar API, manual account addition, or calendar import features."}),e.recommendations=n}},{key:"displayResults",value:function(e){console.log("\n🔍 =================== CALENDAR DISCOVERY DIAGNOSTIC REPORT ==================="),console.log("📅 Timestamp: ".concat(e.timestamp)),console.log("\n📊 Office Context:"),console.log(JSON.stringify(e.officeContext,null,2)),console.log("\n🔗 Graph API Results:"),console.log(JSON.stringify(e.graphApiResults,null,2)),console.log("\n💡 Recommendations:"),e.recommendations.forEach(function(e,n){console.log("".concat(n+1,". [").concat(e.type.toUpperCase(),"] ").concat(e.title)),console.log("   ".concat(e.description)),console.log("   Action: ".concat(e.action,"\n"))}),console.log("=================== END DIAGNOSTIC REPORT ===================\n"),this.updateUI(e)}},{key:"updateUI",value:function(e){try{var n=document.getElementById("calendar-list")||document.getElementById("auth-container");if(!n)return;var t='\n        <div class="diagnostic-results">\n          <h3>🔍 Calendar Discovery Results</h3>\n          \n          <div class="result-section">\n            <h4>📊 Office Context Status</h4>\n            <p><strong>Available:</strong> '.concat(e.officeContext.available?"✅ Yes":"❌ No","</p>\n            ").concat(e.officeContext.available?"\n              <p><strong>Host:</strong> ".concat(e.officeContext.hostName,"</p>\n              <p><strong>User:</strong> ").concat(e.officeContext.userName," (").concat(e.officeContext.userEmail,")</p>\n            "):"\n              <p><strong>Error:</strong> ".concat(e.officeContext.error,"</p>\n            "),'\n          </div>\n\n          <div class="result-section">\n            <h4>🔗 Microsoft Graph API Status</h4>\n            <p><strong>Authentication:</strong> ').concat(e.graphApiResults.accessTokenObtained?"✅ Success":"❌ Failed","</p>\n            <p><strong>Calendars Found:</strong> ").concat(e.graphApiResults.calendarsFound.length,"</p>\n            ").concat(e.graphApiResults.calendarsFound.length>0?"\n              <ul>\n                ".concat(e.graphApiResults.calendarsFound.map(function(e){return"<li>📅 ".concat(e.name," ").concat(e.isDefaultCalendar?"(Default)":"","</li>")}).join(""),"\n              </ul>\n            "):"",'\n          </div>\n\n          <div class="result-section">\n            <h4>💡 Next Steps</h4>\n            ').concat(e.recommendations.map(function(e){return'\n              <div class="recommendation '.concat(e.type,'">\n                <strong>').concat(e.title,"</strong><br>\n                ").concat(e.description,"<br>\n                <em>Action: ").concat(e.action,"</em>\n              </div>\n            ")}).join(""),"\n          </div>\n        </div>\n      ");n.innerHTML=t}catch(e){console.warn("Could not update UI with diagnostic results:",e)}}}]);var e,n,t}();window.CalendarDiscoveryDiagnostic=CalendarDiscoveryDiagnostic;