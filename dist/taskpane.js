/*! For license information please see taskpane.js.LICENSE.txt */
!function(){"use strict";var e={58394:function(e,n,t){e.exports=t.p+"4724c5daddbe7d202087.css"},98362:function(e,n,t){e.exports=t.p+"assets/logo-filled.png"}},n={};function t(r){var a=n[r];if(void 0!==a)return a.exports;var o=n[r]={exports:{}};return e[r](o,o.exports,t),o.exports}t.m=e,t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},function(){var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var r=n.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e}(),t.b=document.baseURI||self.location.href,function(){function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o,c,i=[],s=!0,l=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;s=!1}else for(;!(s=(r=o.call(t)).done)&&(i.push(r.value),i.length!==n);s=!0);}catch(e){l=!0,a=e}finally{try{if(!s&&null!=t.return&&(c=t.return(),Object(c)!==c))return}finally{if(l)throw a}}return i}}(e,n)||a(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=a(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,c=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw c}}}}function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n){if(e){if("string"==typeof e)return o(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,n):void 0}}function o(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach(function(n){s(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s(e,n,t){return(n=p(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function o(t,r,a,o){var s=r&&r.prototype instanceof i?r:i,l=Object.create(s.prototype);return u(l,"_invoke",function(t,r,a){var o,i,s,l=0,u=a||[],f=!1,d={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(n,t){return o=n,i=0,s=e,d.n=t,c}};function y(t,r){for(i=t,s=r,n=0;!f&&l&&!a&&n<u.length;n++){var a,o=u[n],y=d.p,p=o[2];t>3?(a=p===r)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=t<2&&y<o[1])?(i=0,d.v=r,d.n=o[1]):y<p&&(a=t<3||o[0]>r||r>p)&&(o[4]=t,o[5]=r,d.n=p,i=0))}if(a||t>1)return c;throw f=!0,r}return function(a,u,p){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&y(u,p),i=u,s=p;(n=i<2?e:s)||!f;){o||(i?i<3?(i>1&&(d.n=-1),y(i,s)):d.n=s:d.v=s);try{if(l=2,o){if(i||(a="next"),n=o[a]){if(!(n=n.call(o,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=o.return)&&n.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((n=(f=d.n<0)?s:t.call(r,d))!==c)break}catch(n){o=e,i=1,s=n}finally{l=1}}return{value:n,done:f}}}(t,a,o),!0),l}var c={};function i(){}function s(){}function f(){}n=Object.getPrototypeOf;var d=[][r]?n(n([][r]())):(u(n={},r,function(){return this}),n),y=f.prototype=i.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e}return s.prototype=f,u(y,"constructor",f),u(f,"constructor",s),s.displayName="GeneratorFunction",u(f,a,"GeneratorFunction"),u(y),u(y,a,"Generator"),u(y,r,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),(l=function(){return{w:o,m:p}})()}function u(e,n,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}u=function(e,n,t,r){function o(n,t){u(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(o("next",0),o("throw",1),o("return",2))},u(e,n,t,r)}function f(e,n,t,r,a,o,c){try{var i=e[o](c),s=i.value}catch(e){return void t(e)}i.done?n(s):Promise.resolve(s).then(r,a)}function d(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var o=e.apply(n,t);function c(e){f(o,r,a,c,i,"next",e)}function i(e){f(o,r,a,c,i,"throw",e)}c(void 0)})}}function y(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}function p(n){var t=function(n){if("object"!=e(n)||!n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==e(t)?t:t+""}var h,m=function(){return e=function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.syncEnabled=!1,this.calendars=new Map,this.syncInterval=null,this.lastSync=null,this.syncInProgress=!1,this.config={syncIntervalMinutes:15,busyBlockSubject:"[Auto-Sync] Busy",busyBlockCategory:"Auto-Sync",lookAheadDays:0,lookBehindDays:0}},a=[{key:"initialize",value:(A=d(l().m(function e(){var n,t;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,console.log("Initializing Calendar Sync Manager..."),window.Office){e.n=1;break}throw new Error("Office.js is not loaded");case 1:return Office.context&&Office.context.mailbox||console.warn("Limited Office context detected, some features may not work"),console.log("Office context available:",!!Office.context),console.log("Mailbox available:",!(null===(n=Office.context)||void 0===n||!n.mailbox)),e.n=2,this.requestPermissions();case 2:return this.loadConfiguration(),e.n=3,this.discoverCalendars();case 3:this.syncEnabled&&this.startAutoSync(),console.log("Calendar Sync Manager initialized successfully"),e.n=5;break;case 4:throw e.p=4,t=e.v,console.error("Failed to initialize Calendar Sync Manager:",t),t;case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return A.apply(this,arguments)})},{key:"requestPermissions",value:(I=d(l().m(function e(){return l().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,n){try{if(!Office.context||!Office.context.mailbox)return console.warn("Limited Office context, proceeding with basic initialization"),void e();var t=Office.context.mailbox.diagnostics,r=null==t?void 0:t.hostName;console.log("Host diagnostics:",{hostName:r,hostVersion:null==t?void 0:t.hostVersion,platform:null==t?void 0:t.platform}),"Outlook"!==r&&"OutlookWebApp"!==r&&"OutlookIOS"!==r&&"OutlookAndroid"!==r&&r?(console.warn("Unknown host detected, proceeding anyway:",r),e()):(console.log("Host validation passed for:",r||"unknown host"),e())}catch(n){console.error("Error in requestPermissions:",n),e()}}))},e)})),function(){return I.apply(this,arguments)})},{key:"loadConfiguration",value:function(){try{var e=localStorage.getItem("calendarSync_config");if(e){var n=JSON.parse(e);this.config=i(i({},this.config),n)}var t=localStorage.getItem("calendarSync_enabled");this.syncEnabled="true"===t}catch(e){console.warn("Failed to load configuration:",e)}}},{key:"saveConfiguration",value:function(){try{localStorage.setItem("calendarSync_config",JSON.stringify(this.config)),localStorage.setItem("calendarSync_enabled",this.syncEnabled.toString())}catch(e){console.warn("Failed to save configuration:",e)}}},{key:"discoverCalendars",value:(C=d(l().m(function e(){var n,t,r,a=this;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Discovering real Microsoft accounts and calendars..."),e.n=1,this.getGraphCalendars();case 1:if(!((n=e.v)&&n.length>0)){e.n=2;break}this.calendars.clear(),n.forEach(function(e){a.calendars.set(e.id,e)}),console.log("âœ… Discovered ".concat(this.calendars.size," real calendars from Graph API:")),Array.from(this.calendars.values()).forEach(function(e){console.log("  ðŸ“… ".concat(e.name," (").concat(e.userEmail,") - Default: ").concat(e.isDefaultCalendar))}),e.n=3;break;case 2:throw new Error("No calendars returned from Graph API");case 3:case 6:e.n=8;break;case 4:return e.p=4,t=e.v,console.warn("âš ï¸ Graph API discovery failed, checking why:",t),e.p=5,e.n=6,this.tryAlternativeDiscovery();case 7:return e.p=7,r=e.v,console.warn("âš ï¸ Alternative discovery also failed:",r),console.log("ðŸ“ Using enhanced mock data with email simulation..."),e.n=8,this.discoverEnhancedMockCalendars();case 8:return e.a(2)}},e,this,[[5,7],[0,4]])})),function(){return C.apply(this,arguments)})},{key:"tryAlternativeDiscovery",value:(O=d(l().m(function e(){var n,t,r,a,o,c,i,s,u=this;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getGraphAccessToken();case 1:return n=e.v,console.log("ðŸ” Testing Graph API access with user profile..."),e.n=2,fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 2:if((t=e.v).ok){e.n=3;break}throw new Error("Profile API error: ".concat(t.status," ").concat(t.statusText));case 3:return e.n=4,t.json();case 4:return r=e.v,console.log("âœ… Authenticated as: ".concat(r.displayName," (").concat(r.mail||r.userPrincipalName,")")),e.n=5,fetch("https://graph.microsoft.com/v1.0/me/calendars",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 5:if((a=e.v).ok){e.n=7;break}return e.n=6,a.text();case 6:throw o=e.v,new Error("Calendars API error: ".concat(a.status," ").concat(a.statusText," - ").concat(o));case 7:return e.n=8,a.json();case 8:c=e.v,console.log("ðŸ“… Raw calendar data from Graph:",c),i=r.mail||r.userPrincipalName,s=c.value.map(function(e){var n;return{id:e.id,name:e.name,userEmail:(null===(n=e.owner)||void 0===n||null===(n=n.emailAddress)||void 0===n?void 0:n.address)||i,type:"Microsoft Graph",syncEnabled:!0,canEdit:e.canEdit||!1,isDefaultCalendar:e.isDefaultCalendar||!1}}),this.calendars.clear(),s.forEach(function(e){u.calendars.set(e.id,e)}),console.log("âœ… Successfully discovered ".concat(s.length," calendars with emails"));case 9:return e.a(2)}},e,this)})),function(){return O.apply(this,arguments)})},{key:"discoverEnhancedMockCalendars",value:(E=d(l().m(function e(){var n,t=this;return l().w(function(e){for(;;)switch(e.n){case 0:n=[{id:"calendar-1",name:"Primary Work Calendar",userEmail:"dan.hookham@company1.com",type:"Exchange Online",syncEnabled:!0,isDefaultCalendar:!0},{id:"calendar-2",name:"Secondary Work Calendar",userEmail:"dan.hookham@company2.com",type:"Office 365",syncEnabled:!0,isDefaultCalendar:!1},{id:"calendar-3",name:"Personal Calendar",userEmail:"dan.hookham@outlook.com",type:"Outlook.com",syncEnabled:!0,isDefaultCalendar:!1},{id:"calendar-4",name:"Project Calendar",userEmail:"dan.hookham@company3.com",type:"Exchange",syncEnabled:!0,isDefaultCalendar:!1},{id:"calendar-5",name:"Client Calendar",userEmail:"dan.hookham@company4.com",type:"Office 365",syncEnabled:!0,isDefaultCalendar:!1}],this.calendars.clear(),n.forEach(function(e){t.calendars.set(e.id,e)}),console.log("ðŸ“ Using enhanced mock calendars with email addresses:"),n.forEach(function(e){console.log("  ðŸ“… ".concat(e.name," (").concat(e.userEmail,")"))});case 1:return e.a(2)}},e,this)})),function(){return E.apply(this,arguments)})},{key:"getGraphCalendars",value:(S=d(l().m(function e(){var n,t,a,o,c,i,s,u,f,d,y,p,h,m,v,g;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.getGraphAccessToken();case 1:return n=e.v,console.log("ðŸ” Graph access token obtained, fetching calendars..."),e.n=2,fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 2:if((t=e.v).ok){e.n=3;break}throw new Error("Profile API failed: ".concat(t.status));case 3:return e.n=4,t.json();case 4:return a=e.v,o=a.mail||a.userPrincipalName,console.log("ðŸ‘¤ Primary user: ".concat(a.displayName," (").concat(o,")")),e.n=5,fetch("https://graph.microsoft.com/v1.0/me/calendars?$select=id,name,canEdit,isDefaultCalendar,owner",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 5:if((c=e.v).ok){e.n=7;break}return e.n=6,c.text();case 6:throw i=e.v,console.error("Calendar API error response:",i),new Error("Calendar API failed: ".concat(c.status," - ").concat(i));case 7:return e.n=8,c.json();case 8:if(s=e.v,console.log("ðŸ“Š Raw Graph calendar response:",s),s.value&&0!==s.value.length){e.n=9;break}return console.warn("âš ï¸ No calendars found in Graph response"),e.a(2,[]);case 9:return u=[],e.p=10,e.n=11,fetch("https://graph.microsoft.com/v1.0/me/calendarGroups?$expand=calendars",{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});case 11:if(!(f=e.v).ok){e.n=13;break}return e.n=12,f.json();case 12:y=e.v,console.log("ðŸ“‚ Calendar groups found:",y),null===(d=y.value)||void 0===d||d.forEach(function(e){e.calendars&&u.push.apply(u,r(e.calendars))});case 13:e.n=15;break;case 14:e.p=14,v=e.v,console.log("â„¹ï¸ Calendar groups not accessible (normal for some accounts):",v.message);case 15:return p=[].concat(r(s.value),u),h=p.filter(function(e,n,t){return n===t.findIndex(function(n){return n.id===e.id})}),console.log("ðŸ“… Found ".concat(h.length," total calendars (").concat(s.value.length," primary + ").concat(u.length," from groups)")),m=h.map(function(e){var n,t=(null===(n=e.owner)||void 0===n||null===(n=n.emailAddress)||void 0===n?void 0:n.address)||o;return{id:e.id,name:e.name||"Unnamed Calendar",userEmail:t,type:"Microsoft Graph",syncEnabled:!0,canEdit:!1!==e.canEdit,isDefaultCalendar:e.isDefaultCalendar||!1}}),console.log("âœ… Processed calendars:"),m.forEach(function(e){console.log('  ðŸ“… "'.concat(e.name,'" owned by ').concat(e.userEmail," (Default: ").concat(e.isDefaultCalendar,", Editable: ").concat(e.canEdit,")"))}),e.a(2,m);case 16:throw e.p=16,g=e.v,console.error("âŒ getGraphCalendars failed:",g),console.log("ðŸ”„ Will attempt alternative discovery or fall back to mock data"),g;case 17:return e.a(2)}},e,this,[[10,14],[0,16]])})),function(){return S.apply(this,arguments)})},{key:"getGraphAccessToken",value:(k=d(l().m(function e(){var n,t;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,console.log("ðŸ” Requesting Graph access token..."),null!==(n=Office)&&void 0!==n&&null!==(n=n.context)&&void 0!==n&&null!==(n=n.auth)&&void 0!==n&&n.getAccessToken){e.n=1;break}throw new Error("Office.js authentication not available in this context");case 1:return e.a(2,new Promise(function(e,n){Office.context.auth.getAccessToken({allowSignInPrompt:!0,allowConsentPrompt:!0,forMSGraphAccess:!0},function(t){if(console.log("ðŸ” Auth result status:",t.status),t.status===Office.AsyncResultStatus.Succeeded)console.log("âœ… Access token obtained successfully"),console.log("ðŸŽ« Token preview:",t.value.substring(0,20)+"..."),e(t.value);else{console.error("âŒ Authentication failed:",t.error),console.error("Error code:",t.error.code),console.error("Error message:",t.error.message),console.error("Error name:",t.error.name);var r="Authentication failed: ".concat(t.error.message);13001===t.error.code?r+=" (User not signed in - this may require signing into Office)":13002===t.error.code?r+=" (User consent required - admin may need to grant permissions)":13003===t.error.code?r+=" (Invalid audience - token scope issue)":13006===t.error.code?r+=" (Invalid request - check add-in manifest permissions)":13007===t.error.code&&(r+=" (Invalid grant - user may need to re-authenticate)"),n(new Error(r))}})}));case 2:throw e.p=2,t=e.v,console.error("âŒ Failed to get Graph access token:",t),new Error("Authentication setup failed: ".concat(t.message));case 3:return e.a(2)}},e,null,[[0,2]])})),function(){return k.apply(this,arguments)})},{key:"discoverMockCalendars",value:(w=d(l().m(function e(){var n,t=this;return l().w(function(e){for(;;)switch(e.n){case 0:n=[{id:"calendar-1",name:"Primary Work Calendar",userEmail:"user@company1.com",type:"Exchange",syncEnabled:!0,isDefaultCalendar:!0},{id:"calendar-2",name:"Secondary Work Calendar",userEmail:"user@company2.com",type:"Office 365",syncEnabled:!0,isDefaultCalendar:!1},{id:"calendar-3",name:"Personal Calendar",userEmail:"personal@outlook.com",type:"Outlook.com",syncEnabled:!0,isDefaultCalendar:!1}],this.calendars.clear(),n.forEach(function(e){t.calendars.set(e.id,e)}),console.log("Using mock calendars for testing");case 1:return e.a(2)}},e,this)})),function(){return w.apply(this,arguments)})},{key:"getAvailableCalendars",value:(b=d(l().m(function e(){return l().w(function(e){for(;;)if(0===e.n)return e.a(2,Array.from(this.calendars.values()))},e,this)})),function(){return b.apply(this,arguments)})},{key:"toggleCalendarSync",value:function(){var e=d(l().m(function e(n){var t;return l().w(function(e){for(;;)switch(e.n){case 0:if(t=this.calendars.get(n)){e.n=1;break}throw new Error("Calendar not found");case 1:return t.syncEnabled=!t.syncEnabled,this.saveConfiguration(),console.log("Calendar sync ".concat(t.syncEnabled?"enabled":"disabled"," for ").concat(t.name)),e.a(2,t.syncEnabled)}},e,this)}));return function(n){return e.apply(this,arguments)}}()},{key:"performSync",value:(g=d(l().m(function e(){var n,t,r,a,o,c,i,s=arguments;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=s.length>0&&void 0!==s[0]?s[0]:null,!this.syncInProgress){e.n=1;break}throw new Error("Sync already in progress");case 1:if(this.syncInProgress=!0,e.p=2,t=n||new Date,console.log("Starting calendar synchronization for ".concat(t.toLocaleDateString(),"...")),new Date(t).setHours(0,0,0,0),new Date(t).setHours(23,59,59,999),!((r=Array.from(this.calendars.values()).filter(function(e){return e.syncEnabled})).length<2)){e.n=3;break}throw new Error("At least 2 calendars must be enabled for synchronization");case 3:return e.n=4,this.getBusyTimesFromCalendars(r);case 4:return a=e.v,e.n=5,this.removeExistingSyncBlocks(r);case 5:return o=e.v,e.n=6,this.createSyncBlocks(r,a);case 6:return c=e.v,this.lastSync=new Date,console.log("Sync completed: ".concat(c," blocks created, ").concat(o," blocks removed")),e.a(2,{blocksCreated:c,blocksRemoved:o,syncTime:this.lastSync});case 7:throw e.p=7,i=e.v,console.error("Sync failed:",i),i;case 8:return e.p=8,this.syncInProgress=!1,e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(){return g.apply(this,arguments)})},{key:"getBusyTimesFromCalendars",value:(v=d(l().m(function e(n){var r,a,o,c,i,s,u,f;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:r=new Map,a=t(n),e.p=1,a.s();case 2:if((o=a.n()).done){e.n=8;break}return c=o.value,e.p=3,console.log("Fetching busy times for ".concat(c.name," (").concat(c.userEmail,")")),e.n=4,this.getRealBusyTimes(c);case 4:i=e.v,r.set(c.id,i),console.log("Found ".concat(i.length," busy times in ").concat(c.name)),e.n=7;break;case 5:return e.p=5,u=e.v,console.warn("Failed to get busy times for ".concat(c.name,":"),u),e.n=6,this.simulateGetBusyTimes(c);case 6:s=e.v,r.set(c.id,s);case 7:e.n=2;break;case 8:e.n=10;break;case 9:e.p=9,f=e.v,a.e(f);case 10:return e.p=10,a.f(),e.f(10);case 11:return e.a(2,r)}},e,this,[[3,5],[1,9,10,11]])})),function(e){return v.apply(this,arguments)})},{key:"getRealBusyTimes",value:(m=d(l().m(function e(n){var t,r,a,o,c,i,s,u;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.getGraphAccessToken();case 1:return t=e.v,r=this.targetDate||new Date,(a=new Date(r)).setHours(0,0,0,0),(o=new Date(r)).setHours(23,59,59,999),c="https://graph.microsoft.com/v1.0/me/calendars/".concat(n.id,"/events")+"?$filter=start/dateTime ge '".concat(a.toISOString(),"' and end/dateTime le '").concat(o.toISOString(),"'")+"&$select=subject,start,end,showAs,isPrivate",e.n=2,fetch(c,{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});case 2:if((i=e.v).ok){e.n=3;break}throw new Error("Graph API error: ".concat(i.status," ").concat(i.statusText));case 3:return e.n=4,i.json();case 4:return s=e.v,e.a(2,s.value.filter(function(e){return"busy"===e.showAs||"tentative"===e.showAs}).map(function(e){return{start:new Date(e.start.dateTime),end:new Date(e.end.dateTime),subject:e.isPrivate?"[Private]":e.subject||"[No Subject]",isPrivate:e.isPrivate||!1}}));case 5:throw e.p=5,u=e.v,console.error("Graph API call failed for ".concat(n.name,":"),u),u;case 6:return e.a(2)}},e,this,[[0,5]])})),function(e){return m.apply(this,arguments)})},{key:"simulateGetBusyTimes",value:(h=d(l().m(function e(n){var t,r,a,o,c,i;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(e){return setTimeout(e,100)});case 1:for(t=new Date,r=[],a=0;a<Math.floor(5*Math.random())+1;a++)o=new Date(t.getTime()+7*Math.random()*24*60*60*1e3),c=60*(3*Math.random()+.5)*60*1e3,i=new Date(o.getTime()+c),r.push({start:o,end:i,subject:"Meeting in ".concat(n.name),isPrivate:!1});return e.a(2,r)}},e)})),function(e){return h.apply(this,arguments)})},{key:"removeExistingSyncBlocks",value:(p=d(l().m(function e(n){var r,a,o,c,i,s,u;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:r=0,a=t(n),e.p=1,a.s();case 2:if((o=a.n()).done){e.n=7;break}return c=o.value,e.p=3,e.n=4,this.simulateRemoveSyncBlocks(c);case 4:i=e.v,r+=i,e.n=6;break;case 5:e.p=5,s=e.v,console.warn("Failed to remove sync blocks from ".concat(c.name,":"),s);case 6:e.n=2;break;case 7:e.n=9;break;case 8:e.p=8,u=e.v,a.e(u);case 9:return e.p=9,a.f(),e.f(9);case 10:return e.a(2,r)}},e,this,[[3,5],[1,8,9,10]])})),function(e){return p.apply(this,arguments)})},{key:"simulateRemoveSyncBlocks",value:(f=d(l().m(function e(n){return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(e){return setTimeout(e,50)});case 1:return e.a(2,Math.floor(3*Math.random()))}},e)})),function(e){return f.apply(this,arguments)})},{key:"createSyncBlocks",value:(u=d(l().m(function e(a,o){var c,i,s,u,f,d,y,p,h,m,v,g,b;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:c=0,i=t(a),e.p=1,i.s();case 2:if((s=i.n()).done){e.n=7;break}u=s.value,e.p=3,f=[],d=t(o);try{for(d.s();!(y=d.n()).done;)p=n(y.value,2),h=p[0],m=p[1],h!==u.id&&f.push.apply(f,r(m))}catch(e){d.e(e)}finally{d.f()}return e.n=4,this.simulateCreateSyncBlocks(u,f);case 4:v=e.v,c+=v,e.n=6;break;case 5:e.p=5,g=e.v,console.warn("Failed to create sync blocks in ".concat(u.name,":"),g);case 6:e.n=2;break;case 7:e.n=9;break;case 8:e.p=8,b=e.v,i.e(b);case 9:return e.p=9,i.f(),e.f(9);case 10:return e.a(2,c)}},e,this,[[3,5],[1,8,9,10]])})),function(e,n){return u.apply(this,arguments)})},{key:"simulateCreateSyncBlocks",value:(s=d(l().m(function e(n,t){var r,a;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.createRealSyncBlocks(n,t);case 1:return e.a(2,e.v);case 2:return e.p=2,a=e.v,console.warn("Graph API failed, simulating for ".concat(n.name,":"),a),e.n=3,new Promise(function(e){return setTimeout(e,100)});case 3:return r=n.userEmail?"".concat(n.name," (").concat(n.userEmail,")"):n.name,console.log("Would create ".concat(t.length," sync blocks in ").concat(r)),e.a(2,t.length)}},e,this,[[0,2]])})),function(e,n){return s.apply(this,arguments)})},{key:"createRealSyncBlocks",value:(c=d(l().m(function e(n,r){var a,o,c,i,s,u,f,d,y;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,this.getGraphAccessToken();case 1:a=e.v,o=0,c=t(r),e.p=2,c.s();case 3:if((i=c.n()).done){e.n=8;break}return s=i.value,e.p=4,u={subject:this.config.busyBlockSubject,start:{dateTime:s.start.toISOString(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},end:{dateTime:s.end.toISOString(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},showAs:"busy",isPrivate:!0,categories:[this.config.busyBlockCategory],body:{contentType:"text",content:"Auto-synchronized busy time from another calendar"}},e.n=5,fetch("https://graph.microsoft.com/v1.0/me/calendars/".concat(n.id,"/events"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify(u)});case 5:(f=e.v).ok?(o++,console.log("Created sync block in ".concat(n.name,": ").concat(s.start.toLocaleTimeString()," - ").concat(s.end.toLocaleTimeString()))):console.warn("Failed to create sync block in ".concat(n.name,": ").concat(f.status)),e.n=7;break;case 6:e.p=6,d=e.v,console.error("Error creating sync block in ".concat(n.name,":"),d);case 7:e.n=3;break;case 8:e.n=10;break;case 9:e.p=9,y=e.v,c.e(y);case 10:return e.p=10,c.f(),e.f(10);case 11:return console.log("Created ".concat(o," real sync blocks in ").concat(n.name," (").concat(n.userEmail,")")),e.a(2,o)}},e,this,[[4,6],[2,9,10,11]])})),function(e,n){return c.apply(this,arguments)})},{key:"startAutoSync",value:function(){var e=this;this.syncInterval&&clearInterval(this.syncInterval);var n=60*this.config.syncIntervalMinutes*1e3;this.syncInterval=setInterval(function(){e.performSync().catch(function(e){console.error("Auto-sync failed:",e)})},n),console.log("Auto-sync started with ".concat(this.config.syncIntervalMinutes," minute interval"))}},{key:"stopAutoSync",value:function(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null,console.log("Auto-sync stopped"))}},{key:"getSyncStatus",value:(o=d(l().m(function e(){var n;return l().w(function(e){for(;;)switch(e.n){case 0:if(!this.syncInProgress){e.n=1;break}return e.a(2,{state:"Syncing",message:"Synchronization in progress...",lastSync:this.lastSync});case 1:if(this.syncEnabled){e.n=2;break}return e.a(2,{state:"Stopped",message:"Synchronization disabled",lastSync:this.lastSync});case 2:if(!((n=Array.from(this.calendars.values()).filter(function(e){return e.syncEnabled}).length)<2)){e.n=3;break}return e.a(2,{state:"Error",message:"Need at least 2 enabled calendars",lastSync:this.lastSync});case 3:return e.a(2,{state:"Active",message:"Monitoring ".concat(n," calendars"),lastSync:this.lastSync})}},e,this)})),function(){return o.apply(this,arguments)})},{key:"setSyncInterval",value:function(e){this.config.syncIntervalMinutes=e,this.saveConfiguration(),this.syncInterval&&this.startAutoSync()}},{key:"setBusyBlockSubject",value:function(e){this.config.busyBlockSubject=e,this.saveConfiguration()}},{key:"setLookAheadDays",value:function(e){this.config.lookAheadDays=e,this.saveConfiguration()}},{key:"getConfiguration",value:function(){return i({},this.config)}}],a&&y(e.prototype,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,a,o,c,s,u,f,p,h,m,v,g,b,w,k,S,E,O,C,I,A}();function v(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function o(t,r,a,o){var s=r&&r.prototype instanceof i?r:i,l=Object.create(s.prototype);return g(l,"_invoke",function(t,r,a){var o,i,s,l=0,u=a||[],f=!1,d={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(n,t){return o=n,i=0,s=e,d.n=t,c}};function y(t,r){for(i=t,s=r,n=0;!f&&l&&!a&&n<u.length;n++){var a,o=u[n],y=d.p,p=o[2];t>3?(a=p===r)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=t<2&&y<o[1])?(i=0,d.v=r,d.n=o[1]):y<p&&(a=t<3||o[0]>r||r>p)&&(o[4]=t,o[5]=r,d.n=p,i=0))}if(a||t>1)return c;throw f=!0,r}return function(a,u,p){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&y(u,p),i=u,s=p;(n=i<2?e:s)||!f;){o||(i?i<3?(i>1&&(d.n=-1),y(i,s)):d.n=s:d.v=s);try{if(l=2,o){if(i||(a="next"),n=o[a]){if(!(n=n.call(o,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=o.return)&&n.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((n=(f=d.n<0)?s:t.call(r,d))!==c)break}catch(n){o=e,i=1,s=n}finally{l=1}}return{value:n,done:f}}}(t,a,o),!0),l}var c={};function i(){}function s(){}function l(){}n=Object.getPrototypeOf;var u=[][r]?n(n([][r]())):(g(n={},r,function(){return this}),n),f=l.prototype=i.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,g(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=l,g(f,"constructor",l),g(l,"constructor",s),s.displayName="GeneratorFunction",g(l,a,"GeneratorFunction"),g(f),g(f,a,"Generator"),g(f,r,function(){return this}),g(f,"toString",function(){return"[object Generator]"}),(v=function(){return{w:o,m:d}})()}function g(e,n,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}g=function(e,n,t,r){function o(n,t){g(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(o("next",0),o("throw",1),o("return",2))},g(e,n,t,r)}function b(e,n,t,r,a,o,c){try{var i=e[o](c),s=i.value}catch(e){return void t(e)}i.done?n(s):Promise.resolve(s).then(r,a)}function w(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var o=e.apply(n,t);function c(e){b(o,r,a,c,i,"next",e)}function i(e){b(o,r,a,c,i,"throw",e)}c(void 0)})}}function k(){return S.apply(this,arguments)}function S(){return(S=w(v().m(function e(){var n;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,document.getElementById("sync-now").onclick=I,document.getElementById("configure").onclick=P,e.n=1,h.initialize();case 1:return e.n=2,E();case 2:return e.n=3,D();case 3:setInterval(D,3e4),e.n=5;break;case 4:e.p=4,n=e.v,console.error("Failed to initialize app:",n),B("Error","Initialization failed: ".concat(n.message));case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function E(){return O.apply(this,arguments)}function O(){return(O=w(v().m(function e(){var n;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,h.getAvailableCalendars();case 1:C(e.v),e.n=3;break;case 2:e.p=2,n=e.v,console.error("Failed to load calendars:",n),document.getElementById("calendar-list").innerHTML='<div class="error">Failed to load calendars. Please check permissions.</div>';case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function C(e){var n=document.getElementById("calendar-list");0!==e.length?n.innerHTML=e.map(function(e){return'\n    <div class="calendar-item">\n      <div>\n        <div class="calendar-name">'.concat(e.name,'</div>\n        <div class="calendar-status">').concat(e.type," â€¢ ").concat(e.itemCount,' items</div>\n      </div>\n      <div class="calendar-toggle">\n        <div class="toggle-switch ').concat(e.syncEnabled?"active":"",'" \n             data-calendar-id="').concat(e.id,'"\n             onclick="toggleCalendarSync(\'').concat(e.id,"')\">\n        </div>\n      </div>\n    </div>\n  ")}).join(""):n.innerHTML='<div class="no-activity">No calendars found</div>'}function I(){return A.apply(this,arguments)}function A(){return(A=w(v().m(function e(){var n,t,r,a;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=document.getElementById("sync-date").value){e.n=1;break}return B("Error","Please select a date to sync"),e.a(2);case 1:return t=new Date(n),B("Syncing","Syncing ".concat(t.toLocaleDateString(),"...")),G(!0),e.n=2,h.performSync(t);case 2:r=e.v,B("Active","Sync completed for ".concat(t.toLocaleDateString(),". ").concat(r.blocksCreated," blocks created, ").concat(r.blocksRemoved," removed.")),M("Sync completed for ".concat(t.toLocaleDateString(),": ").concat(r.blocksCreated," created, ").concat(r.blocksRemoved," removed")),e.n=4;break;case 3:e.p=3,a=e.v,console.error("Sync failed:",a),B("Error","Sync failed: ".concat(a.message)),M("Sync failed: ".concat(a.message));case 4:return e.p=4,G(!1),e.f(4);case 5:return e.a(2)}},e,null,[[0,3,4,5]])}))).apply(this,arguments)}function P(){return T.apply(this,arguments)}function T(){return(T=w(v().m(function e(){return v().w(function(e){for(;;)switch(e.n){case 0:console.log("Configure clicked");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function j(){return(j=w(v().m(function e(n){var t,r,a;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,h.toggleCalendarSync(n);case 1:t=e.v,(r=document.querySelector('[data-calendar-id="'.concat(n,'"]')))&&r.classList.toggle("active",t),M("Calendar sync ".concat(t?"enabled":"disabled"," for calendar")),e.n=3;break;case 2:e.p=2,a=e.v,console.error("Failed to toggle calendar sync:",a),M("Failed to toggle calendar sync: ".concat(a.message));case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function D(){return x.apply(this,arguments)}function x(){return(x=w(v().m(function e(){var n,t;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,h.getSyncStatus();case 1:B((n=e.v).state,n.message),n.lastSync&&(document.getElementById("last-sync").textContent="Last sync: ".concat(new Date(n.lastSync).toLocaleString())),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Failed to get sync status:",t),B("Error","Unable to check sync status");case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function B(e,n){var t=document.getElementById("status-dot"),r=document.getElementById("status-text");switch(t.classList.remove("active","syncing"),e.toLowerCase()){case"active":t.classList.add("active");break;case"syncing":t.classList.add("syncing")}r.textContent=n}function G(e){var n=document.getElementById("sync-now"),t=n.querySelector(".ms-Button-label");n.style.opacity=e?"0.6":"1",n.style.pointerEvents=e?"none":"auto",t.textContent=e?"Syncing...":"Sync Now"}function M(e){var n=document.getElementById("activity-log"),t=n.querySelector(".no-activity");t&&t.remove();var r=document.createElement("div");r.className="activity-item",r.innerHTML='\n    <div class="activity-time">'.concat((new Date).toLocaleTimeString(),"</div>\n    <div>").concat(e,"</div>\n  "),n.insertBefore(r,n.firstChild);var a=n.querySelectorAll(".activity-item");a.length>10&&a[a.length-1].remove()}Office.onReady(function(e){try{if(console.log("Office.onReady called with info:",e),e.host===Office.HostType.Outlook||"Outlook"===e.host||window.Office){console.log("Host validated as Outlook"),document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex";var n=new Date("2025-08-12");document.getElementById("sync-date").value=n.toISOString().split("T")[0],h=new m,k()}else console.error("Unsupported host application. Host info:",e),document.getElementById("sideload-msg").innerHTML='\n        <div style="color: red; padding: 10px;">\n          <h3>Host Detection Issue</h3>\n          <p>Detected host: '.concat(e.host,"</p>\n          <p>Expected: Outlook</p>\n          <p>Trying to continue anyway...</p>\n        </div>\n      "),h=new m,k()}catch(e){console.error("Office.onReady error:",e),document.getElementById("sideload-msg").innerHTML='\n      <div style="color: red; padding: 10px;">\n        <h3>Initialization Error</h3>\n        <p>'.concat(e.message,"</p>\n        <p>Please try refreshing the page</p>\n      </div>\n    ")}}),window.addEventListener("DOMContentLoaded",function(){setTimeout(function(){if(!h&&window.Office){console.log("Fallback initialization triggered");try{document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex";var e=new Date("2025-08-12");document.getElementById("sync-date").value=e.toISOString().split("T")[0],h=new m,k()}catch(e){console.error("Fallback initialization failed:",e)}}},2e3)}),window.toggleCalendarSync=function(e){return j.apply(this,arguments)}}(),new URL(t(58394),t.b),new URL(t(98362),t.b)}();
//# sourceMappingURL=taskpane.js.map